<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dynamic Calling Tree</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@40,200,1,200" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
      <link href="./css/style.css"
      rel="stylesheet">

  <style>
    
    .contact-column {
      padding: 15px;
      margin-bottom: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .person-group {
      margin-bottom: 10px;
    }
    .delete-btn {
      background-color: #dc3545;
      color: white;
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h1>Calling Tree</h1>
    <div class="row mt-3" id="callingTree">
      <!-- Dynamic content will be added here -->
      <div class="col-md-4">
        <!-- Initial contact group will be added here -->
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-md-4">
        <button class="btn btn-primary" id="addContactBtn">Add Contact</button>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS and jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Counter for unique IDs
    let contactCounter = 0;

    function createContactElement(contactId) {
      const deleteButton = contactCounter === 0 ? '' : `<button class="btn btn-sm btn-danger float-end delete-btn" onclick="deleteContact('${contactId}')">Remove</button>`;
      const contactElement = `
        <div class="contact-column" id="${contactId}">
          ${deleteButton}
          <h5 class="mb-3">Who will be contacted during an emergency?</h5>
     
          <div class="form-group d-flex mt-3">
            <span class="material-symbols-rounded pr-5">
              person
            </span>
            <input type="text" name="contactName${contactId}" class="my-2 w-100 p-2 rounded" placeholder="Enter Contact Name">
          </div>
          <div class="form-group d-flex">
            <span class="material-symbols-rounded pr-5">
              call
            </span>
            <input type="text" name="contactNum${contactId}" class="my-2 w-100 p-2 rounded " placeholder="Enter Contact Number">
          </div>
          <div class="form-group d-flex">
            <span class="material-symbols-rounded pr-5">
              mail
            </span>
            <input type="email" name="contactEml${contactId}" class="my-2 w-100 p-2 rounded" placeholder="Enter Contact Email">
          </div>
          <hr> <!-- Breaker added here -->
          <p class="text-muted">Assign specific individuals to reach out to contact</p>
          <div class="person-group" id="personGroup_${contactId}">
            
          </div>
          <div class="d-grid gap-2 mb-5">
            <button class="btn btn-success" onclick="addPerson('${contactId}')">Add Person</button>
          </div>
        </div>
      `;
      return contactElement;
    }

    function addPerson(contactId) {
      const personGroup = $(`#personGroup_${contactId}`);
      const personId = personGroup.children().length;
      const newPerson = createPersonElement(contactId, personId);
      personGroup.append(newPerson);
    }

    function createPersonElement(contactId, personId) {
      const personElement = `
        <div class="form-group d-flex mt-3" id="person_${contactId}_${personId}">
          <span class="material-symbols-rounded pr-5">
            person
          </span>
          <input type="text" name="personName${contactId}_${personId}" class="w-75 p-2 rounded" placeholder="Enter Person Name">
          <button class="btn btn-sm btn-danger mx-2" onclick="deletePerson('${contactId}', ${personId})">Delete</button>
        </div>
      `;
      return personElement;
    }

    function deletePerson(contactId, personId) {
      $(`#person_${contactId}_${personId}`).remove();
    }

    function deleteContact(contactId) {
      $("#" + contactId).parent().remove();

      // Show "Add Contact" button when a contact group is deleted
      $("#addContactBtn").show();

      // Move "Add Contact" button back to the second column when there's only one group
      if (contactCounter === 1) {
        $(".col-md-4").removeClass("col-md-6 offset-md-3").addClass("col-md-4");
      }
    }

    function addContact() {
      const contactId = `contact_${contactCounter}`;
      const newContact = createContactElement(contactId);

      // If it's the first contact group, append it to the existing row
      if (contactCounter === 0) {
        $(".row#callingTree .col-md-4").html(newContact);
      } else {
        // Otherwise, append it to a new row
        $(".row#callingTree").append(`<div class="col-md-4">${newContact}</div>`);
      }

      contactCounter++;

      // Hide "Add Contact" button after the third contact group is added
      if (contactCounter >= 3) {
        $("#addContactBtn").hide();
      }

      return contactId;
    }

    $(document).ready(function () {
      // Initial contact element
      addContact();

      // Event listener for adding contacts
      $("#addContactBtn").click(function () {
        addContact();
      });
    });
  </script>
</body>
</html>
